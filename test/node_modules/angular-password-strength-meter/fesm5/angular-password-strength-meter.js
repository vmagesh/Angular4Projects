import { __decorate } from 'tslib';
import { Injectable, EventEmitter, Input, Output, Component, NgModule } from '@angular/core';
import * as zxcvbn_ from 'zxcvbn';
import { CommonModule } from '@angular/common';

var zxcvbn = zxcvbn_;
var PasswordStrengthMeterService = /** @class */ (function () {
    function PasswordStrengthMeterService() {
    }
    /**
     *  this will return the password strength score in number
     *  0 - too guessable
     *  1 - very guessable
     *  2 - somewhat guessable
     *  3 - safely unguessable
     *  4 - very unguessable
     *
     *  @param password - Password
     */
    PasswordStrengthMeterService.prototype.score = function (password) {
        var result = zxcvbn(password);
        return result.score;
    };
    /**
     * this will return the password strength score with feedback messages
     * return type { score: number; feedback: { suggestions: string[]; warning: string } }
     *
     * @param password - Password
     */
    PasswordStrengthMeterService.prototype.scoreWithFeedback = function (password) {
        var result = zxcvbn(password);
        return { score: result.score, feedback: result.feedback };
    };
    PasswordStrengthMeterService = __decorate([
        Injectable()
    ], PasswordStrengthMeterService);
    return PasswordStrengthMeterService;
}());

var PasswordStrengthMeterComponent = /** @class */ (function () {
    function PasswordStrengthMeterComponent(passwordStrengthMeterService) {
        this.passwordStrengthMeterService = passwordStrengthMeterService;
        this.minPasswordLength = 8;
        this.enableFeedback = false;
        this.colors = [];
        this.strengthChange = new EventEmitter();
        this.passwordStrength = null;
        this.feedback = null;
        this.prevPasswordStrength = null;
        this.defaultColours = [
            'darkred',
            'orangered',
            'orange',
            'yellowgreen',
            'green'
        ];
    }
    PasswordStrengthMeterComponent.prototype.ngOnInit = function () { };
    PasswordStrengthMeterComponent.prototype.ngOnChanges = function (changes) {
        if (changes.password) {
            this.calculatePasswordStrength();
        }
    };
    PasswordStrengthMeterComponent.prototype.calculatePasswordStrength = function () {
        // TODO validation logic optimization
        if (!this.password) {
            this.passwordStrength = null;
        }
        else if (this.password && this.password.length < this.minPasswordLength) {
            this.passwordStrength = 0;
        }
        else {
            if (this.enableFeedback) {
                var result = this.passwordStrengthMeterService.scoreWithFeedback(this.password);
                this.passwordStrength = result.score;
                this.feedback = result.feedback;
            }
            else {
                this.passwordStrength = this.passwordStrengthMeterService.score(this.password);
                this.feedback = null;
            }
        }
        // Only emit the passwordStrength if it changed
        if (this.prevPasswordStrength !== this.passwordStrength) {
            this.strengthChange.emit(this.passwordStrength);
            this.prevPasswordStrength = this.passwordStrength;
        }
    };
    PasswordStrengthMeterComponent.prototype.getMeterFillColor = function (strength) {
        if (!strength || strength < 0 || strength > 5) {
            return this.colors[0] ? this.colors[0] : this.defaultColours[0];
        }
        return this.colors[strength]
            ? this.colors[strength]
            : this.defaultColours[strength];
    };
    PasswordStrengthMeterComponent.ctorParameters = function () { return [
        { type: PasswordStrengthMeterService }
    ]; };
    __decorate([
        Input()
    ], PasswordStrengthMeterComponent.prototype, "password", void 0);
    __decorate([
        Input()
    ], PasswordStrengthMeterComponent.prototype, "minPasswordLength", void 0);
    __decorate([
        Input()
    ], PasswordStrengthMeterComponent.prototype, "enableFeedback", void 0);
    __decorate([
        Input()
    ], PasswordStrengthMeterComponent.prototype, "colors", void 0);
    __decorate([
        Output()
    ], PasswordStrengthMeterComponent.prototype, "strengthChange", void 0);
    PasswordStrengthMeterComponent = __decorate([
        Component({
            selector: 'password-strength-meter',
            template: "<div>\n  <div class=\"strength-meter\">\n    <div class=\"strength-meter-fill\" [style.background]=\"getMeterFillColor(passwordStrength)\" [attr.data-strength]=\"passwordStrength\"></div>\n  </div>\n  <ng-container *ngIf=\"enableFeedback && feedback\">\n    <small class=\"password-feedback\" *ngIf=\"feedback.warning\">\n      {{feedback.warning}}\n    </small>\n    <small class=\"password-suggetion\" *ngIf=\"feedback.suggestions && feedback.suggestions.length > 0\">\n      <ng-container *ngFor=\"let suggetion of feedback.suggestions\">{{suggetion}}</ng-container>\n    </small>\n  </ng-container>\n</div>\n",
            providers: [PasswordStrengthMeterService],
            styles: [".strength-meter{position:relative;height:3px;background:#ddd;margin:10px auto;border-radius:3px}.strength-meter:after,.strength-meter:before{content:\"\";height:inherit;background:0 0;display:block;border-color:#fff;border-style:solid;border-width:0 5px;position:absolute;width:calc(((100% - 20px)/ 5) + 10px);z-index:10}.strength-meter:before{left:calc((100% - 20px)/ 5)}.strength-meter:after{right:calc((100% - 20px)/ 5)}.strength-meter-fill{background:0 0;height:inherit;position:absolute;width:0;border-radius:inherit;transition:width .5s ease-in-out,background .25s}.strength-meter-fill[data-strength=\"0\"]{background:#8b0000;width:20%}.strength-meter-fill[data-strength=\"1\"]{background:#ff4500;width:40%}.strength-meter-fill[data-strength=\"2\"]{background:orange;width:60%}.strength-meter-fill[data-strength=\"3\"]{background:#9acd32;width:80%}.strength-meter-fill[data-strength=\"4\"]{background:green;width:100%}.password-feedback,.password-suggetion{font-size:70%;font-weight:400;color:#6c757d!important;display:inline-block;margin-top:.25rem}"]
        })
    ], PasswordStrengthMeterComponent);
    return PasswordStrengthMeterComponent;
}());

var PasswordStrengthMeterModule = /** @class */ (function () {
    function PasswordStrengthMeterModule() {
    }
    PasswordStrengthMeterModule = __decorate([
        NgModule({
            imports: [CommonModule],
            declarations: [PasswordStrengthMeterComponent],
            exports: [PasswordStrengthMeterComponent]
        })
    ], PasswordStrengthMeterModule);
    return PasswordStrengthMeterModule;
}());

/*
 * Public API Surface of password-strength-meter
 */

/**
 * Generated bundle index. Do not edit.
 */

export { PasswordStrengthMeterComponent, PasswordStrengthMeterModule, PasswordStrengthMeterService };
//# sourceMappingURL=angular-password-strength-meter.js.map
